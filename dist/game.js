"use strict";(()=>{var y=class{constructor(){this.setupControls=(t,e,i,n)=>{this._move=t,this._shoot=e,this._skip=i,this._reset=n}}};var u=class{constructor(t){this._gridSquares=t}static{this.EVENTNAME="game.update"}get gridSquares(){return this._gridSquares}get eventName(){return"game.update"}};var E=class{constructor(t){this._enemy=t}static{this.EVENTNAME="enemy.hit"}get enemy(){return this._enemy}get type(){return this._enemy.constructor.name}get x(){return this._enemy.position.x}get y(){return this._enemy.position.y}get eventName(){return"enemy.hit"}};var x=class{constructor(t){this._player=t}static{this.EVENTNAME="player.spawn"}get player(){return this._player}get x(){return this.player.position.x}get y(){return this.player.position.y}get eventName(){return"player.spawn"}};var P=class extends y{constructor(e){super();this.eventManager=e;this.enemies=[];this.act=()=>{let e,i;this.enemies.length===0&&!this.target||(this.target?.position.x===this.player.position.x?(this.removeTrackedEnemies(this.target),e=this._shoot):(i=this.player.position.x>this.target?.position.x,e=this._move),setTimeout(()=>{i!==void 0?e(i):e()},175))};this.findBiggerThreat=()=>this.enemies.reduce((e,i)=>{let n=this.calculateThreat(e),o=this.calculateThreat(i);return n>o?e:i});this.calculateThreat=e=>e.position.y*2*e.difficulty;this.addTrackedEnemies=e=>{e.enemy&&(this.enemies.push(e.enemy),this.target=this.findBiggerThreat())};this.removeTrackedEnemies=e=>{this.enemies=this.enemies.filter(i=>i!==void 0).filter(i=>i!==e)};this.setPlayer=e=>{this.player=e.player};this.eventManager.subscribe(u.EVENTNAME,this.act),this.eventManager.subscribe(E.EVENTNAME,this.addTrackedEnemies),this.eventManager.subscribe(x.EVENTNAME,this.setPlayer)}};var p=class{constructor(t){this._enemy=t}static{this.EVENTNAME="enemy.death"}get enemy(){return this._enemy}get x(){return this._enemy.position.x}get y(){return this._enemy.position.y}get eventName(){return"enemy.death"}};var l=class{constructor(t){this._win=t}static{this.EVENTNAME="game.over"}get eventName(){return"game.over"}get win(){return this._win}};var w=r=>Math.floor(Math.random()*r);var M=class{constructor(t){this._enemy=t}static{this.EVENTNAME="enemy.hit"}get icon(){return this._enemy.icon}get x(){return this._enemy.position.x}get y(){return this._enemy.position.y}get eventName(){return"enemy.hit"}};var S=class{constructor(t){this._position=t}static{this.EVENTNAME="player.shoot"}get x(){return this._position.x}get y(){return this._position.y}get eventName(){return"player.shoot"}};var I=class{constructor(t,e,i,n){this.grid=t;this.characterFactory=e;this.eventManager=i;this.configurationManager=n;this.enemies=[];this.changes=[];this.boss=null;this.deadEnemyCount=0;this.initialize=()=>{this.afterRoundActions()};this.reset=()=>{this.enemies=[],this.changes=[],this.boss=null};this.movePlayer=t=>{let e=this.player.position;if(t&&e.x<=0||!t&&e.x>=this.grid.getMaxX)return;let i=e.clone();t?i.substractX():i.addX(),this.player.position=i;let n=this.grid.getGridSquare(e),o=this.grid.getGridSquare(i);n.removeCharacter(),o.setCharacter(this.player),this.changes.push(n,o),this.afterRoundActions()};this.shoot=()=>{this.eventManager.publish(new S(this.player.position));let t=this.enemies.filter(e=>e.position.x===this.player.position.x)?.reduce((e,i)=>(e=e===null?i:e,i.position.y>e.position.y?i:e),null);t&&(t.reduceHealth(1),this.eventManager.publish(new M(t))),this.afterRoundActions()};this.afterRoundActions=()=>{let t=this.checkWincondition();this.removeDeadEnemies();let e=this.checkLosecondition();if(t||e){this.eventManager.publish(new l(t));return}this.moveEnemies(),this.spawnEnemy(),this.eventManager.publish(new u(this.changes)),this.changes=[]};this.checkWincondition=()=>!!this.enemies.find(e=>e.isBoss&&e.isDead);this.checkLosecondition=()=>!!this.enemies.find(e=>{let i=e.possiblePositions[0];return e.movement.y>0&&this.grid.isOutOfBoundsY(i)});this.removeDeadEnemies=()=>{this.enemies=this.enemies.map(t=>(t.isDead&&(this.removeEnemy(t),this.eventManager.publish(new p(t)),this.deadEnemyCount+=1),t)).filter(t=>!t.isDead)};this.removeEnemy=t=>{let e=this.grid.getGridSquare(t.position);e.removeCharacter(),this.changes.push(e)};this.moveEnemies=()=>{this.enemies.forEach(t=>{let i=t.possiblePositions.filter(a=>this.grid.isValidPosition(a)&&this.grid.isEmpty(a));if(i.length===0){t.setPosition(t.position);return}this.removeEnemy(t);let n=i[w(i.length)];t.setPosition(n);let o=this.grid.getGridSquare(n);o.setCharacter(t),this.changes.push(o)})};this.spawnPlayer=()=>{let t=this.grid.getGridSquare(this.player.position);t.setCharacter(this.player),this.changes.push(t);let e=new x(this.player);this.eventManager.publish(e)};this.spawnEnemy=()=>{if(this.isBoardFull())return;let t=this.grid.getEmptySpawn(),e=this.spawnBoss()?this.characterFactory.createKing():this.characterFactory.createRandomEnemy();t.setCharacter(e),this.changes.push(t),e.setPosition(t.position,!1),this.enemies.push(e),this.changes.push(t),this.eventManager.publish(new E(e))};this.spawnBoss=()=>this.deadEnemyCount===this.configurationManager.getDifficultyConfigurations().enemyAmount&&!this.boss;this.isBoardFull=()=>this.enemies.length>=this.configurationManager.getDifficultyConfigurations().maxEnemies;this.player=this.characterFactory.createPlayer(),this.spawnPlayer()}};var N=class{constructor(t){this.configuration=t;this.canvases=[];this.createCanvas=t=>{let e=document.createElement("canvas");e.style.position="absolute",e.style.top="100px",e.style.left="10px",e.id=t,this.canvases.push(e);let i=e.getContext("2d"),n=10;return i.canvas.width=this.gridConfiguration.width*this.gridConfiguration.gridSquareWidth+2*n,i.canvas.height=this.gridConfiguration.height*this.gridConfiguration.gridSquareHeight+100,e};this.gridConfiguration=this.configuration.getGridConfigurations()}};var C=class{get position(){return this._position}get icon(){return this._icon}};var s=class{constructor(t,e){this._x=t;this._y=e}get x(){return this._x}get y(){return this._y}};var c=class r{constructor(t,e){this._x=t;this._y=e;this.addX=()=>this._x+=1;this.substractX=()=>this._x-=1;this.equals=t=>this._x===t.x&&this._y===t.y;this.notNull=()=>this._x!==-1||this._y!==-1;this.clone=()=>new r(this._x,this._y)}static{this.createNullPosition=()=>new this(-1,-1)}get x(){return this._x}get y(){return this._y}};var d=class extends C{constructor(e,i){super();this._movementIndex=0;this.setPosition=(e,i=!0)=>{this._position=e,i&&this.updateMovementIndex()};this.reduceHealth=e=>{this._health-=e};this._position=e,this._health=i,this._movements=[[new s(0,0),new s(0,1)]]}updateMovementIndex(){this._movementIndex=this._movementIndex==this._movements[0].length-1?0:this._movementIndex+1}get isDead(){return this._health<=0}get position(){return this._position}get movement(){return this._movements[0][this._movementIndex]}get possiblePositions(){return this._movements.map(e=>new c(this._position.x+e[this._movementIndex].x,this._position.y+e[this._movementIndex].y))}get icon(){return this._icon}get isBoss(){return!1}get difficulty(){return 1}get score(){return this._score}};var G=class extends d{constructor(e,i){super(e,i);this.reduceHealth=e=>{this._health-=e};this._icon=document.getElementById("king"),this._movements=[[new s(0,0),new s(0,0),new s(-1,1)],[new s(0,0),new s(0,0),new s(0,1)],[new s(0,0),new s(0,0),new s(1,1)]],this._score=5}get isBoss(){return!0}get difficulty(){return 3}};var A=class extends d{constructor(t,e){super(t,e),this._icon=document.getElementById("knight"),this._movements=[[new s(0,0),new s(1,2)],[new s(0,0),new s(-1,2)]],this._score=3}get difficulty(){return 2}};var T=class extends d{constructor(t,e){super(t,e),this._icon=document.getElementById("pawn"),this._movements=[[new s(0,0),new s(0,1)]],this._score=1}};var q=class extends C{constructor(){super();this.updatePosition=e=>{let i=this._position.x;e=="ArrowLeft"?i-=this._position.x>0?1:0:i+=this._position.x<9?1:0,this._position=new c(i,this._position.y)};this._icon=document.getElementById("player"),this._position=new c(0,15)}set position(e){this._position=e}get position(){return this._position}};var k=class{constructor(){this.createRandomEnemy=()=>{let t=Math.floor(Math.random()*3);return t%2===0&&t!=0?this.createKnight():this.createPawn()};this.createPawn=()=>new T(new c(1,1),1);this.createKnight=()=>new A(new c(1,1),1);this.createKing=()=>new G(new c(1,1),10);this.createPlayer=()=>new q}};var ht={controls:{left:"ArrowLeft",right:"ArrowRight",shoot:"ArrowUp",skip:"ArrowDown",reset:"Space"},difficulty:[{roundLength:1e3,enemyHealth:1,bossHealth:5,enemyAmount:20,maxEnemies:3}],gridConfiguration:{width:10,height:15,gridSquareWidth:40,gridSquareHeight:40,iconHeight:35,iconWidth:30,elementId:"game-container"},misc:{autoplay:!1,infinite:!1},hs:["aHR0cHM6Ly81ankwaW5scG8wLmV4ZWN1dGUtYXBpLmV1LW5vcnRoLTEuYW1hem9uYXdzLmNvbS9iZXRhL2hpZ2hzY29yZQ==","aHR0cHM6Ly81ankwaW5scG8wLmV4ZWN1dGUtYXBpLmV1LW5vcnRoLTEuYW1hem9uYXdzLmNvbS9iZXRhL25ld0hpZ2hTY29yZQ=="]};var H=class{constructor(){this.configableConfiguration=()=>{let t=new URLSearchParams(window.location.search);t.has("autoplay")&&(this.configurations.misc.autoplay=!!t.get("autoplay")),t.has("infinite")&&this.setInfinite()};this.setInfinite=()=>{this.configurations.difficulty[0].enemyAmount=-1};this.getControlConfigurations=()=>this.configurations.controls;this.getDifficultyConfigurations=()=>this.configurations.difficulty[0];this.getGridConfigurations=()=>this.configurations.gridConfiguration;this.getMiscConfiguration=t=>this.configurations.misc[t];this.getHsConfigurations=()=>this.configurations.hs;this.configurations=ht,this.configableConfiguration()}};var F=class extends y{constructor(e){super();this.controls=e;this.handleAction=e=>{switch(e.code){case this.controls.left:this._move(!0);break;case this.controls.right:this._move(!1);break;case this.controls.shoot:this._shoot();break;case this.controls.skip:this._skip();break;case this.controls.reset:this._reset();break}};document.addEventListener("keyup",this.handleAction)}};var B=class{constructor(t,e,i){this.gridConfiguration=t;this.effectFactory=e;this.canvasFactory=i;this.animations=[];this.draw=()=>{document.getElementById(this.gridConfiguration.elementId)?.append(this.canvas)};this.addAnimation=(t,e)=>{let i=this.effectFactory.getEffect(e,t);i&&this.animations.push(i),this.requestAnimation()};this.requestAnimation=()=>{this.hasAnimations()&&(this.context.clearRect(0,0,1e3,1e3),this.animations.forEach(t=>{t.update(),this.drawParticles(t)}),this.removeAnimations(),requestAnimationFrame(this.requestAnimation))};this.hasAnimations=()=>this.animations.length!=0;this.removeAnimations=()=>{this.animations=this.animations.filter(t=>!t.isDead())};this.drawParticles=t=>{t.particles.forEach(e=>{this.context.beginPath(),this.context.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),this.context.fillStyle=`rgba(255,100, 0, ${e.alpha})`,this.context.fill()})};this.canvas=this.canvasFactory.createCanvas("effect"),this.context=this.canvas.getContext("2d")}};var R=class{constructor(t,e,i,n,o,a,m,h){this._x=t;this._y=e;this.dx=i;this.dy=n;this.up=o;this.right=a;this._ttl=m;this.update=()=>{this._x+=this.right==!0?+-this.dx:this.dx,this._y+=this.up==!0?+-this.dy:this.dy,this._ttl-=10,this._alpha-=.02};this.isDead=()=>this.ttl<=0;this._alpha=1,this._radius=h||1.5}get x(){return this._x}get y(){return this._y}get radius(){return this._radius}get alpha(){return this._alpha}get ttl(){return this._ttl}};var L=class{constructor(t){this._position=t;this.particleCount=20;this.ttl=300;this.isDead=()=>this.activeParticles.length===0;this.update=()=>this.activeParticles.length>0?(this.activeParticles.forEach(t=>{t.update(),t.isDead()&&(this.activeParticles=this.activeParticles.filter(e=>e!==t))}),this.activeParticles):[];this.activeParticles=[];let e=this._position.centerX,i=this._position.centerY;for(let n=0;n<this.particleCount;n++){let o=(Math.random()-.5)*2,a=(Math.random()-.5)*2,m=Math.floor(Math.random()*10)%2==0,h=Math.floor(Math.random()*10)%2==0;this.activeParticles.push(new R(e,i,o,a,m,h,this.ttl))}}get particles(){return this.activeParticles}};var V=class{constructor(){this.getEffect=(t,e)=>{switch(t){case"explosion":return this.createExplosion(e)}};this.createExplosion=t=>new L(t)}};var D=class{constructor(){this._events={};this.subscribe=(t,e)=>{this.events[t]=this.events[t]||[],this.events[t].push(e)};this.unsubscribe=(t,e)=>{this.events[t]&&(this.events[t]=this.events[t].filter(i=>i!==e))};this.publish=t=>{this.events[t.eventName]&&this.events[t.eventName].forEach(e=>e(t))}}get events(){return this._events}};var g=class{constructor(t){this.canvasFactory=t}};var X=class extends g{constructor(e,i,n,o,a){super(e);this.canvasFactory=e;this.grid=i;this.effectCanvas=n;this.positionConverter=o;this.eventManager=a;this.initialize=()=>{this.eventManager.subscribe(u.EVENTNAME,this.updateGrid),this.eventManager.subscribe(p.EVENTNAME,this.addEffect),this.draw()};this.end=()=>this.grid.clearCanvas();this.addEffect=e=>{let i=this.positionConverter.map(e.x,e.y,null);this.effectCanvas.addAnimation(i,"explosion")};this.updateGrid=e=>{this.clearEmptySquares(e.gridSquares),this.renderSquares(e.gridSquares)};this.clearEmptySquares=e=>{e.filter(i=>i.isEmpty()).map(i=>this.positionConverter.map(i.x,i.y,i.icon)).forEach(i=>this.grid.clearPosition(i))};this.renderSquares=e=>{e.filter(i=>!i.isEmpty()).map(i=>this.positionConverter.map(i.x,i.y,i.icon)).forEach(i=>this.grid.renderIcon(i))}}draw(){this.grid.initialize(),this.effectCanvas.draw()}destroy(){this.eventManager.unsubscribe(u.EVENTNAME,this.updateGrid),this.eventManager.unsubscribe(p.EVENTNAME,this.addEffect),this.grid.destroy()}};var b=class{static{this.EVENTNAME="round.skip"}get eventName(){return"round.skip"}};var f=class{constructor(t){this._sceneName=t}static{this.EVENT_NAME="scene.change"}get eventName(){return"scene.change"}};var W=class{constructor(t,e,i,n,o,a){this.eventManager=t;this.board=e;this.controller=i;this.state=n;this.renderer=o;this.api=a;this.update=()=>{this.eventManager.subscribe(b.EVENTNAME,this.board.afterRoundActions),this.eventManager.subscribe(l.EVENTNAME,this.endGame)};this.setControls=()=>{this.controller.setupControls(this.board.movePlayer,this.board.shoot,this.board.afterRoundActions,()=>{})};this.endGame=t=>{this.state.stop(),this.end(t.win)};this.end=async t=>{let e=t?"win":"lose";try{await this.api.highscore(this.state.score())}catch{}confirm(`You ${e}!`),this.state.reset(),this.eventManager.publish(new f("menu"))}}initialize(){this.board.initialize(),this.setControls(),this.update(),this.state.start(),this.renderer.initialize()}destroy(){this.board.reset(),this.state.reset(),this.state.stop(),this.renderer.destroy(),this.eventManager.unsubscribe(b.EVENTNAME,this.board.afterRoundActions),this.eventManager.unsubscribe(l.EVENTNAME,this.endGame)}};var _=class{constructor(t){this._position=t;this.notNull=()=>this.position.notNull();this.isEmpty=()=>this._character===null;this.setCharacter=t=>this._character=t;this.removeCharacter=()=>this._character=null;this._character=null}get position(){return this._position}get x(){return this._position.x}get y(){return this._position.y}get icon(){return this._character?.icon??null}static{this.create=()=>new this(c.createNullPosition())}};var z=class{constructor(t){this.gridConfiguration=t;this.grid=[];this.buildGrid=()=>{for(let t=0;t<=this.gridConfiguration.height;t++)for(let e=0;e<this.gridConfiguration.width;e++){let i=new c(e,t);this.grid.push(new _(i))}};this.getGridSquare=t=>{let e=t.y*this.gridConfiguration.width+t.x;return this.grid[e]??_.create()};this.isValidPosition=t=>t.x>=0&&t.x<this.gridConfiguration.width&&t.y>=0&&t.y<=this.gridConfiguration.height;this.isEmpty=t=>this.getGridSquare(t).isEmpty();this.isOutOfBoundsX=t=>t.x>=this.gridConfiguration.width;this.isOutOfBoundsY=t=>t.y>=this.gridConfiguration.height;this.getEmptySpawn=()=>{let t=this.grid.slice(0,this.getMaxX).filter(e=>e.isEmpty());return t[w(t.length-1)]};this.buildGrid()}get getMaxX(){return this.gridConfiguration.width-1}};var Y=class{constructor(t,e,i,n,o,a,m){this._canvasX=t;this._canvasY=e;this._xPadding=i;this._yPadding=n;this._centerX=o;this._centerY=a;this._icon=m;this.isEmpty=()=>this.icon===null}get icon(){return this._icon}get iconPositionX(){return this._canvasX}get iconPositionY(){return this._canvasY}get iconPositionXWithPadding(){return this.iconPositionX+this._xPadding}get iconPositionYWithPadding(){return this.iconPositionY+this._yPadding}get centerX(){return this._centerX}get centerY(){return this._centerY}};var O=class{constructor(t){this.gridConfiguration=t;this.map=(t,e,i)=>{let n=i?(this.gridConfiguration.gridSquareWidth-this.gridConfiguration.iconWidth)/2:0,o=i?(this.gridConfiguration.gridSquareHeight-this.gridConfiguration.iconHeight)/2:0,a=t*this.gridConfiguration.gridSquareWidth,m=e*this.gridConfiguration.gridSquareHeight,h=t*this.gridConfiguration.gridSquareWidth+this.gridConfiguration.gridSquareWidth/2,at=e*this.gridConfiguration.gridSquareHeight+this.gridConfiguration.gridSquareHeight/2;return new Y(a,m,n,o,h,at,i)}}};var U=class{constructor(t,e){this.menuRenderer=t;this.api=e}initialize(){this.menuRenderer.initialize()}update(){throw new Error("Method not implemented.")}destroy(){this.menuRenderer.destroy()}};var Z=class{constructor(t,e){this.text=t;this.context=e;this.setPosition=(t,e)=>{this.x=t,this.y=e};this.setSize=(t,e)=>{this.width=t,this.height=e};this.draw=()=>{this.context.fillStyle="rgb(255, 255, 255)",this.context.fillRect(this.x,this.y,this.width,this.height),this.context.fillStyle="rgb(0, 0, 0)",this.context.fillText(this.text,this.x+this.width/2,this.y+this.height/2,this.width)}}inBounds(t,e){return t>this.x&&t<this.x+this.width&&e>this.y&&e<this.y+this.height}};var K=class{constructor(t){this.context=t;this.draw=t=>{if(t.items){this.context.fillStyle="rgb(0, 0, 0)",this.context.fillText("High Score",200,250),this.context.font="18px arial";let e=295;t.items.forEach(i=>{this.context.fillText(`${i.username}: ${i.score}`,100,e),e+=25})}}}};var ct=class{constructor(t){this.context=t;this.letters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_.,";this.width=20;this.height=20;this.letterIndex=null;this.setPosition=(t,e)=>{this.x=t,this.y=e};this.addIndex=()=>{this.letterIndex===null?this.letterIndex=0:this.letterIndex=this.letterIndex<this.letters.length?this.letterIndex+1:null,this.draw()};this.inBounds=(t,e)=>t>this.x&&t<this.x+this.width+10&&e>this.y&&e<this.y+this.height+10;this.draw=()=>{this.context.fillStyle="rgb(150,150, 150)",this.context.fillRect(this.x,this.y,30,30),this.letter()};this.letter=()=>{this.context.fillStyle="rgb(255,255,255)",this.letterIndex!=null&&this.context.fillText(this.letters[this.letterIndex],this.x+15,this.y+17)}}},J=class{constructor(t){this.context=t;this.usernameButtons=[];this.setPosition=(t,e)=>{this.x=t,this.y=e,this.context.fillText("Player: ",this.x,this.y)};this.createLetters=()=>{for(let t=1;t<=6;t++){let e=new ct(this.context),i=this.x+5+t*35,n=this.y-15;e.setPosition(i,n),this.usernameButtons.push(e)}};this.draw=()=>this.usernameButtons.forEach(t=>t.draw());this.buttonClick=(t,e)=>{let i=this.usernameButtons.find(n=>n.inBounds(t,e))??null;return i&&i.addIndex(),this.draw(),i}}};var v=class{constructor(t){this._highscore=t}static{this.EVENTNAME="api.highscore"}get eventName(){return"api.highscore"}get highscore(){return this._highscore}};var $=class extends g{constructor(e,i,n,o){super(i);this.eventManager=e;this.canvasFactory=i;this.gridConfiguration=n;this.background=o;this.highscore_enabled=!1;this.gameOver=()=>{};this.initialize=()=>{this.eventManager.subscribe(l.EVENTNAME,this.gameOver),this.eventManager.subscribe(v.EVENTNAME,this.drawHighscore),this.background.draw(),this.background.startAnimation(),this.canvas=this.canvasFactory.createCanvas("menu"),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("click",this.buttonClick),this.draw()};this.destroy=()=>{this.canvas.remove(),this.background.stopAnimation(),this.background.destroy(),this.eventManager.unsubscribe(l.EVENTNAME,this.gameOver),this.eventManager.unsubscribe(v.EVENTNAME,this.drawHighscore)};this.drawHighscore=e=>new K(this.context).draw(e.highscore);this.buttonClick=e=>{let i=e.pageX,n=e.pageY;if(this.playButton.inBounds(i-this.canvas.offsetLeft,n-this.canvas.offsetTop)){let o=new f("game");this.destroy(),this.eventManager.publish(o)}else{let o=this.usernameButton.buttonClick(i-this.canvas.offsetLeft,n-this.canvas.offsetTop)}}}async draw(){document.getElementById(this.gridConfiguration.elementId)?.append(this.canvas);let e=this.gridConfiguration.width*this.gridConfiguration.gridSquareWidth,i=this.gridConfiguration.height*this.gridConfiguration.gridSquareHeight;this.context.textAlign="center",this.context.textBaseline="middle",this.context.font="25px arial",this.context.globalAlpha=.1,this.context.fillStyle="rgb(0, 255, 255)",this.context.fillRect(0,0,e,i),this.context.globalAlpha=1,this.playButton=new Z("Play",this.context),this.playButton.setPosition(45,50),this.playButton.setSize(300,100),this.playButton.draw(),this.usernameButton=new J(this.context),this.usernameButton.setPosition(90,200),this.usernameButton.createLetters(),this.usernameButton.draw()}};var j=class extends g{constructor(e,i){super(e);this.canvasFactory=e;this.gridConfiguration=i;this.initialize=()=>{this.canvas=this.canvasFactory.createCanvas("game"),this.context=this.canvas.getContext("2d"),this.draw()};this.clearCanvas=()=>{this.context.clearRect(0,0,1e3,1e3)};this.clearPosition=e=>{this.context.clearRect(e.iconPositionX+2,e.iconPositionY+2,this.gridConfiguration.gridSquareWidth-3,this.gridConfiguration.gridSquareHeight-3)};this.renderIcon=e=>{let i=e?.icon;i&&this.context.drawImage(i,e.iconPositionXWithPadding,e.iconPositionYWithPadding,i.width,i.height)};this.draw=()=>{document.getElementById(this.gridConfiguration.elementId)?.append(this.canvas);let e=this.gridConfiguration.width*this.gridConfiguration.gridSquareWidth,i=this.gridConfiguration.height*this.gridConfiguration.gridSquareHeight;this.drawHorizontal(e,i),this.drawVertital(e,i),this.context.strokeStyle="black",this.context?.stroke()};this.drawHorizontal=(e,i)=>{for(let n=0;n<=e;n+=this.gridConfiguration.gridSquareWidth){let o=.5+n,a=0,m=.5+n,h=i;this.context?.moveTo(o,a),this.context?.lineTo(m,h)}};this.drawVertital=(e,i)=>{for(let n=0;n<=i;n+=this.gridConfiguration.gridSquareHeight){let a=.5+n,m=e,h=.5+n;this.context?.moveTo(0,a),this.context?.lineTo(m,h)}}}destroy(){this.context.reset(),this.canvas.remove()}};var Q=class{constructor(t,e,i){this.eventManager=t;this.gameScene=e;this.menuScene=i;this.initialize=()=>{this.currentScene.initialize()};this.changeScene=()=>{this.currentScene.destroy(),this.currentScene=this.currentScene===this.gameScene?this.menuScene:this.gameScene,this.currentScene.initialize()};this.updateScene=()=>{this.currentScene.update()};this.endScene=()=>{this.currentScene.destroy()};this.currentScene=this.menuScene,this.eventManager.subscribe(f.EVENT_NAME,this.changeScene)}};var tt=class{constructor(t){this.eventManager=t;this.isActive=!1;this.roundLength=500;this.currentRoundLength=0;this.kills=0;this._score=0;this.start=()=>{this.eventManager.subscribe(u.EVENTNAME,this.resetCounter),this.eventManager.subscribe(p.EVENTNAME,this.addScore),this.isActive=!0,this.loopId||(this.loopId=requestAnimationFrame(this.loop))};this.stop=()=>{this.eventManager.unsubscribe(u.EVENTNAME,this.resetCounter),this.eventManager.unsubscribe(p.EVENTNAME,this.addScore),this.isActive=!1,this.loopId=0};this.reset=()=>{this._score=0,this.kills=0,this.currentRoundLength=0};this.addScore=t=>{let e=t.enemy;this._score+=e.score*8};this.resetCounter=()=>{this.currentRoundLength=0};this.score=()=>this._score;this.loop=()=>{this.isActive&&(this.currentRoundLength>=this.roundLength?(this.currentRoundLength=0,this.eventManager.publish(new b)):this.currentRoundLength+=5,requestAnimationFrame(this.loop))}}};var et=class{constructor(t,e){this._config=t;this.eventManager=e;this.setUsername=t=>{this.u=t};this.getHighscore=async()=>{let t,e=sessionStorage.getItem("data");if(e){let i=JSON.parse(e);return this.token=i.token,this.eventManager.publish(new v(i)),i}try{let i=await fetch(atob(this._config[0]),{method:"GET"});if(i.status!==200)throw new Error("Unable");return t=await i.json(),sessionStorage.setItem("data",JSON.stringify(t)),this.eventManager.publish(new v(t)),t}catch{return{}}};this.highscore=async t=>{if(!this.u)return;let e={token:this.token,score:t,username:"RIPPE"};sessionStorage.removeItem("data");try{return await fetch(atob(this._config[1]),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch{}}}};var it=class{constructor(t,e,i){this.gridConfiguration=t;this.canvasFactory=e;this.backgroundEffect=i;this.draw=()=>{document.getElementById(this.gridConfiguration.elementId)?.append(this.canvas)};this.startAnimation=()=>{this.context.globalAlpha=.05,this.requestAnimation()};this.stopAnimation=()=>{this.backgroundEffect.stop()};this.destroy=()=>{this.canvas.remove()};this.requestAnimation=()=>{this.backgroundEffect.isOn()&&(this.context.clearRect(0,0,1e3,1e3),this.drawParticles(),requestAnimationFrame(this.requestAnimation))};this.drawParticles=()=>{this.backgroundEffect.update().forEach(e=>{this.context.drawImage(e.icon,e.x,e.y,25,25)})};this.canvas=this.canvasFactory.createCanvas("background"),this.context=this.canvas.getContext("2d")}};var rt=class{constructor(t,e,i){this._x=t;this._y=e;this.character=i;this._ttl=800;this.update=()=>{this._y-=.75,this._ttl-=1};this.isDead=()=>this._ttl<=0}get x(){return this._x}get y(){return this._y}get alpha(){return this._alpha}get icon(){return this.character.icon}get width(){return 50}get height(){return 50}};var nt=class{constructor(t,e){this.gridConfig=t;this.characterFactory=e;this.activeParticles=[];this.particleCount=10;this.spawnNew=400;this.lastSpawn=0;this.isOn=()=>this.activeParticles.length>0;this.stop=()=>{this.activeParticles=[]};this.createItem=()=>{let t=w(this.gridConfig.width)*50,e=585,i=this.characterFactory.createRandomEnemy();this.activeParticles.push(new rt(t,e,i))};this.update=()=>this.activeParticles.length===0?[]:(this.lastSpawn>this.spawnNew&&(this.activeParticles.length<this.particleCount&&this.createItem(),this.lastSpawn=0),this.activeParticles.forEach(t=>{t.update(),t.isDead()&&(this.activeParticles=this.activeParticles.filter(e=>e!==t),this.createItem())}),this.lastSpawn+=5,this.activeParticles);this.destroy=()=>{this.stop()};this.createItem()}};var ot=class{constructor(){let t=new H,e=new V,i=new D,n=new tt(i),o=new N(t),a=new X(o,new j(o,t.getGridConfigurations()),new B(t.getGridConfigurations(),e,o),new O(t.getGridConfigurations()),i),m=new et(t.getHsConfigurations(),i),h=new k,at=new $(i,o,t.getGridConfigurations(),new it(t.getGridConfigurations(),o,new nt(t.getGridConfigurations(),h))),ut=t.getMiscConfiguration("autoplay")?new P(i):new F(t.getControlConfigurations()),mt=new I(new z(t.getGridConfigurations()),h,i,t);this._sceneManager=new Q(i,new W(i,mt,ut,n,a,m),new U(at,m))}get sceneManager(){return this._sceneManager}};var st=class{constructor(){this.initialize=()=>{this.sceneManager.initialize()};this.bootstrap=new ot,this.sceneManager=this.bootstrap.sceneManager}};new st().initialize();})();
